{% extends "base.html" %}

{% block title %}Dashboard - YouTube Automation{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div style="font-size: 12px; color: #6c757d; margin-bottom: 8px; text-transform: uppercase; font-weight: 500;">Automation Status</div>
                <div id="status-badge" class="status-badge status-inactive mb-2">
                    <i class="bi bi-pause-circle"></i> Inactive
                </div>
                <div style="font-size: 13px; color: #6c757d;" id="status-message">Scheduling is disabled</div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div style="font-size: 12px; color: #6c757d; margin-bottom: 8px; text-transform: uppercase; font-weight: 500;">Last Run</div>
                <div style="font-size: 20px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;" id="last-run">
                    <i class="bi bi-clock-history"></i> Never
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div style="font-size: 12px; color: #6c757d; margin-bottom: 8px; text-transform: uppercase; font-weight: 500;">Next Run</div>
                <div style="font-size: 20px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;" id="next-run">
                    <i class="bi bi-calendar-event"></i> Not scheduled
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div style="font-size: 12px; color: #6c757d; margin-bottom: 8px; text-transform: uppercase; font-weight: 500;">Database</div>
                <div style="font-size: 20px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">
                    <i class="bi bi-database"></i> Active
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Quick Actions</div>
            <div class="card-body">
                <div style="margin-bottom: 16px;">
                    <button class="btn btn-primary" id="run-now-btn" onclick="runNow()" style="width: 100%;">
                        <i class="bi bi-play-circle"></i> Run Automation Now
                    </button>
                </div>
                <div class="d-grid gap-2">
                    <a href="/playlists" class="btn btn-outline-secondary">
                        <i class="bi bi-collection-play"></i> View Playlists
                    </a>
                    <a href="/calendar" class="btn btn-outline-secondary">
                        <i class="bi bi-calendar-event"></i> View Calendar
                    </a>
                    <a href="/config" class="btn btn-outline-secondary">
                        <i class="bi bi-gear"></i> Configure Settings
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Current Settings</div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 14px;">
                    <div>
                        <div style="color: #6c757d; margin-bottom: 4px;">Videos per day</div>
                        <div style="font-weight: 600; color: #1a1a1a;" id="videos-per-day">{{ settings.scheduling.videos_per_day }}</div>
                    </div>
                    <div>
                        <div style="color: #6c757d; margin-bottom: 4px;">Schedule day</div>
                        <div style="font-weight: 600; color: #1a1a1a;" id="schedule-day">{{ settings.scheduling.schedule_day|title }}</div>
                    </div>
                    <div>
                        <div style="color: #6c757d; margin-bottom: 4px;">YouTube time</div>
                        <div style="font-weight: 600; color: #1a1a1a;" id="youtube-time">{{ settings.scheduling.youtube_schedule_time }}</div>
                    </div>
                    <div>
                        <div style="color: #6c757d; margin-bottom: 4px;">Social time</div>
                        <div style="font-weight: 600; color: #1a1a1a;" id="social-time">{{ settings.scheduling.social_media_schedule_time }}</div>
                    </div>
                    <div>
                        <div style="color: #6c757d; margin-bottom: 4px;">Auto-post</div>
                        <div style="font-weight: 600; color: #1a1a1a;">
                            <span class="badge bg-{{ 'success' if settings.scheduling.auto_post_social else 'secondary' }}">
                                {{ 'Yes' if settings.scheduling.auto_post_social else 'No' }}
                            </span>
                        </div>
                    </div>
                    <div>
                        <div style="color: #6c757d; margin-bottom: 4px;">Platforms</div>
                        <div id="social-platforms">
                            {% for platform in settings.scheduling.social_platforms %}
                            <span class="badge bg-info me-1">{{ platform|title }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function updateStatus() {
        fetch('/api/status')
            .then(response => response.json())
            .then(data => {
                const badge = document.getElementById('status-badge');
                const message = document.getElementById('status-message');
                const lastRun = document.getElementById('last-run');
                const nextRun = document.getElementById('next-run');

                if (data.enabled) {
                    badge.className = 'status-badge status-active mb-2';
                    badge.innerHTML = '<i class="bi bi-check-circle"></i> Active';
                    message.textContent = 'Automation is scheduled and running';
                } else {
                    badge.className = 'status-badge status-inactive mb-2';
                    badge.innerHTML = '<i class="bi bi-pause-circle"></i> Inactive';
                    message.textContent = 'Scheduling is disabled';
                }

                if (data.last_run) {
                    const date = new Date(data.last_run);
                    lastRun.innerHTML = `<i class="bi bi-clock-history"></i> ${date.toLocaleString()}`;
                }

                if (data.next_run) {
                    const date = new Date(data.next_run);
                    nextRun.innerHTML = `<i class="bi bi-calendar-event"></i> ${date.toLocaleString()}`;
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function runNow() {
        const btn = document.getElementById('run-now-btn');
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Running...';

        fetch('/api/run-now', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-play-circle"></i> Run Automation Now';
                setTimeout(updateStatus, 2000);
            })
            .catch(error => {
                alert('Error: ' + error);
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-play-circle"></i> Run Automation Now';
            });
    }

    // Update status every 30 seconds
    updateStatus();
    setInterval(updateStatus, 30000);
</script>
{% endblock %}
