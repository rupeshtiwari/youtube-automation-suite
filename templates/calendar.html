{% extends "base.html" %}

{% block title %}Calendar - YouTube Automation{% endblock %}

{% block page_title %}Calendar{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
<style>
    /* Buffer-style Calendar */
    .calendar-container {
        background: var(--buffer-card-bg);
        border: 1px solid var(--buffer-border);
        border-radius: 8px;
        padding: 24px;
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .fc {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .fc-header-toolbar {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--buffer-border);
        transition: border-color 0.3s ease;
    }

    .fc-toolbar-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--buffer-text);
        transition: color 0.3s ease;
    }

    .fc-button {
        background: var(--buffer-input-bg);
        border: 1px solid var(--buffer-border);
        color: var(--buffer-text);
        padding: 6px 12px;
        font-weight: 500;
        font-size: 14px;
        border-radius: 6px;
        text-transform: none;
        transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    .fc-button:hover {
        background: var(--buffer-hover);
        border-color: var(--buffer-border);
    }

    .fc-button-primary:not(:disabled):active,
    .fc-button-primary:not(:disabled).fc-button-active {
        background: var(--buffer-primary);
        border-color: var(--buffer-primary);
        color: var(--buffer-bg);
    }

    [data-theme="dark"] .fc-button-primary:not(:disabled):active,
    [data-theme="dark"] .fc-button-primary:not(:disabled).fc-button-active {
        color: var(--buffer-bg-light);
    }

    .fc-button-primary:focus {
        box-shadow: 0 0 0 3px rgba(26, 26, 26, 0.1);
    }

    .fc-daygrid-day {
        border-color: var(--buffer-border);
        transition: border-color 0.3s ease;
    }

    .fc-day-today {
        background-color: var(--buffer-hover) !important;
    }

    .fc-col-header-cell {
        background: var(--buffer-bg-light);
        border-color: var(--buffer-border);
        padding: 12px;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        color: var(--buffer-text-light);
        transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    /* Event Styles - Buffer Style */
    .fc-event {
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        margin-bottom: 4px;
    }

    .fc-event-linkedin {
        background: #0077b5;
        color: white;
    }

    .fc-event-facebook {
        background: #1877f2;
        color: white;
    }

    .fc-event-instagram {
        background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
        color: white;
    }

    .fc-event-title {
        font-weight: 500;
    }

    .fc-event-time {
        font-weight: 600;
        opacity: 0.9;
    }

    .fc-daygrid-event {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Calendar View Controls */
    .calendar-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #e9ecef;
    }

    .view-selector {
        display: flex;
        gap: 8px;
        background: #f8f9fa;
        padding: 4px;
        border-radius: 6px;
    }

    .view-btn {
        padding: 6px 16px;
        border: none;
        background: transparent;
        color: #6c757d;
        font-weight: 500;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .view-btn.active {
        background: white;
        color: #1a1a1a;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    /* Legend */
    .calendar-legend {
        display: flex;
        gap: 24px;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid var(--buffer-border);
        transition: border-color 0.3s ease;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--buffer-text);
        transition: color 0.3s ease;
    }

    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
    }

    .legend-color.linkedin {
        background: #0077b5;
    }

    .legend-color.facebook {
        background: #1877f2;
    }

    .legend-color.instagram {
        background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
    }

    /* Event Modal - Buffer Style */
    .event-modal {
        border-radius: 8px;
    }

    .event-modal .modal-header {
        border-bottom: 1px solid var(--buffer-border);
        padding: 20px 24px;
        background: var(--buffer-card-bg);
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .event-modal .modal-title {
        font-weight: 600;
        font-size: 18px;
        color: var(--buffer-text);
        transition: color 0.3s ease;
    }

    .event-modal .modal-body {
        padding: 24px;
        background: var(--buffer-card-bg);
        color: var(--buffer-text);
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .event-modal .modal-content {
        background: var(--buffer-card-bg);
        border: 1px solid var(--buffer-border);
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .event-platform {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 4px;
        font-weight: 500;
        font-size: 14px;
        margin-bottom: 16px;
    }

    .event-platform.linkedin {
        background: #e6f2f8;
        color: #0077b5;
    }

    .event-platform.facebook {
        background: #e7f0fd;
        color: #1877f2;
    }

    .event-platform.instagram {
        background: #fce8f0;
        color: #e4405f;
    }

    .event-content {
        background: var(--buffer-bg-light);
        border-radius: 6px;
        padding: 16px;
        margin-top: 16px;
        font-size: 14px;
        line-height: 1.6;
        color: var(--buffer-text);
        white-space: pre-wrap;
        transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    .event-video-details {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--buffer-border);
    }
    
    .event-detail-row {
        display: flex;
        align-items: flex-start;
        margin-bottom: 12px;
        font-size: 14px;
    }
    
    .event-detail-label {
        font-weight: 600;
        color: var(--buffer-text-light);
        min-width: 120px;
        margin-right: 12px;
    }
    
    .event-detail-value {
        color: var(--buffer-text);
        flex: 1;
    }
    
    .event-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 8px;
    }
    
    .event-tag {
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .event-tag.type {
        background: #dbeafe;
        color: #1e40af;
    }
    
    .event-tag.role {
        background: #fef3c7;
        color: #92400e;
    }
    
    .event-tag.custom {
        background: #e9d5ff;
        color: #6b21a8;
    }
    
    /* Schedule Button */
    .schedule-new-btn {
        position: fixed;
        bottom: 32px;
        right: 32px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--buffer-primary);
        color: white;
        border: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        transition: all 0.3s;
    }
    
    .schedule-new-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }
    
    [data-theme="dark"] .schedule-new-btn {
        background: var(--buffer-primary);
        color: var(--buffer-bg-light);
    }
    
    /* Schedule Modal */
    .schedule-modal .modal-body {
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .video-select-item {
        padding: 12px;
        border: 1px solid var(--buffer-border);
        border-radius: 8px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .video-select-item:hover {
        background: var(--buffer-hover);
        border-color: var(--buffer-primary);
    }
    
    .video-select-item.selected {
        background: var(--buffer-hover);
        border-color: var(--buffer-primary);
        border-width: 2px;
    }

    .event-meta {
        display: flex;
        gap: 24px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--buffer-border);
        font-size: 14px;
        color: var(--buffer-text-light);
        transition: border-color 0.3s ease, color 0.3s ease;
    }

    .event-meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Tips Sidebar */
    .tips-sidebar {
        position: sticky;
        top: 20px;
    }

    .tips-sidebar .card {
        border: 1px solid var(--border);
        transition: all 0.3s ease;
    }

    .tip-item {
        padding: 12px;
        margin-bottom: 12px;
        background: var(--bg-secondary);
        border-left: 3px solid var(--primary);
        border-radius: 6px;
        font-size: 13px;
        line-height: 1.6;
    }

    .tip-item.tip-success {
        border-left-color: var(--success);
        background: rgba(16, 185, 129, 0.05);
    }

    .tip-item.tip-warning {
        border-left-color: var(--warning);
        background: rgba(245, 158, 11, 0.05);
    }

    .tip-item.tip-info {
        border-left-color: var(--info);
        background: rgba(6, 182, 212, 0.05);
    }

    .tip-item-header {
        font-weight: 600;
        margin-bottom: 6px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .tip-item-content {
        color: var(--text-secondary);
        font-size: 12px;
    }

    .stat-item {
        padding: 12px 0;
        border-bottom: 1px solid var(--border);
    }

    .stat-item:last-child {
        border-bottom: none;
    }

    .stat-label {
        font-size: 12px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
    }

    .stat-value {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary);
    }

    .legend-color.youtube {
        background: #ff0000;
    }
</style>
{% endblock %}

{% block content %}
<!-- Tips & Insights Sidebar -->
<div class="row">
    <div class="col-md-9">
        <div class="calendar-container">
            <div id="calendar"></div>
            
            <div class="calendar-legend">
                <div class="legend-item">
                    <div class="legend-color linkedin"></div>
                    <span>LinkedIn</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color facebook"></div>
                    <span>Facebook</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color instagram"></div>
                    <span>Instagram</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color youtube"></div>
                    <span>YouTube</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="tips-sidebar">
            <div class="card mb-3">
                <div class="card-header">
                    <i class="bi bi-lightbulb"></i> Smart Tips
                </div>
                <div class="card-body" id="smartTips">
                    <div class="text-center py-3">
                        <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                        <p class="text-muted mt-2 mb-0">Loading tips...</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-bar-chart"></i> Calendar Stats
                </div>
                <div class="card-body" id="calendarStats">
                    <div class="stat-item">
                        <div class="stat-label">Scheduled This Week</div>
                        <div class="stat-value" id="statWeek">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Scheduled This Month</div>
                        <div class="stat-value" id="statMonth">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Most Active Platform</div>
                        <div class="stat-value" id="statPlatform">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Event Detail Modal -->
<div class="modal fade event-modal" id="eventModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventModalTitle">Event Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="eventModalPlatform" class="event-platform"></div>
                <div id="eventModalVideoTitle" style="font-weight: 600; font-size: 18px; margin-bottom: 12px; color: var(--buffer-text);"></div>
                <div id="eventModalContent" class="event-content"></div>
                <div class="event-meta">
                    <div class="event-meta-item">
                        <i class="bi bi-clock"></i>
                        <span id="eventModalTime"></span>
                    </div>
                    <div class="event-meta-item">
                        <i class="bi bi-tag"></i>
                        <span id="eventModalStatus"></span>
                    </div>
                    <div class="event-meta-item">
                        <a href="#" id="eventModalLink" target="_blank" class="text-decoration-none">
                            <i class="bi bi-youtube"></i>
                            View Video
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    
    // Fetch calendar events
    fetch('/api/calendar-data')
        .then(response => response.json())
        .then(data => {
            const events = data.events || [];
            
            // Format events for FullCalendar
            const calendarEvents = events.map(event => {
                // Ensure time format is correct
                let timeStr = event.time || '12:00:00';
                if (!timeStr.includes(':')) {
                    timeStr = '12:00:00';
                } else if (timeStr.split(':').length === 2) {
                    timeStr = timeStr + ':00';
                }
                const dateStr = event.date + 'T' + timeStr;
                const platformLower = event.platform.toLowerCase();
                
                // Create a more descriptive title with video details
                const typeLabel = event.video_type ? `[${event.video_type}] ` : '';
                const roleLabel = event.role ? `[${event.role}] ` : '';
                const titleShort = event.video_title.length > 40 ? event.video_title.substring(0, 40) + '...' : event.video_title;
                
                return {
                    id: event.video_id + '-' + platformLower,
                    title: `${event.platform}: ${typeLabel}${roleLabel}${titleShort}`,
                    start: dateStr,
                    backgroundColor: platformLower === 'linkedin' ? '#0077b5' : 
                                   (platformLower === 'facebook' ? '#1877f2' : '#e4405f'),
                    borderColor: platformLower === 'linkedin' ? '#0077b5' : 
                                (platformLower === 'facebook' ? '#1877f2' : '#e4405f'),
                    extendedProps: {
                        platform: event.platform,
                        video_title: event.video_title,
                        video_id: event.video_id,
                        youtube_url: event.youtube_url,
                        post_content: event.post_content,
                        status: event.status,
                        date: event.date,
                        time: event.time,
                        video_type: event.video_type || '',
                        role: event.role || '',
                        custom_tags: event.custom_tags || '',
                        playlist_name: event.playlist_name || '',
                        channel_name: event.channel_name || '',
                        description: event.description || ''
                    },
                    className: `fc-event-${platformLower}`
                };
            });
            
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: calendarEvents,
                eventClick: function(info) {
                    const props = info.event.extendedProps;
                    const modal = new bootstrap.Modal(document.getElementById('eventModal'));
                    
                    // Set platform badge
                    const platformClass = props.platform.toLowerCase();
                    const platformColors = {
                        'linkedin': { bg: '#e6f2f8', color: '#0077b5' },
                        'facebook': { bg: '#e7f0fd', color: '#1877f2' },
                        'instagram': { bg: '#fce8f0', color: '#e4405f' }
                    };
                    const colors = platformColors[platformClass] || { bg: '#f8f9fa', color: '#2c3e50' };
                    
                    document.getElementById('eventModalPlatform').innerHTML = `
                        <i class="bi bi-${platformClass}"></i> ${props.platform}
                    `;
                    document.getElementById('eventModalPlatform').className = `event-platform ${platformClass}`;
                    document.getElementById('eventModalPlatform').style.background = colors.bg;
                    document.getElementById('eventModalPlatform').style.color = colors.color;
                    
                    document.getElementById('eventModalVideoTitle').textContent = props.video_title;
                    document.getElementById('eventModalContent').textContent = props.post_content || 'No content available';
                    document.getElementById('eventModalTime').textContent = 
                        new Date(props.date + 'T' + props.time).toLocaleString();
                    document.getElementById('eventModalStatus').textContent = 
                        props.status.charAt(0).toUpperCase() + props.status.slice(1);
                    document.getElementById('eventModalLink').href = props.youtube_url || '#';
                    
                    // Add video details
                    const detailsHtml = `
                        <div class="event-video-details">
                            ${props.channel_name ? `
                            <div class="event-detail-row">
                                <span class="event-detail-label"><i class="bi bi-broadcast"></i> Channel:</span>
                                <span class="event-detail-value">${escapeHtml(props.channel_name)}</span>
                            </div>` : ''}
                            ${props.playlist_name ? `
                            <div class="event-detail-row">
                                <span class="event-detail-label"><i class="bi bi-collection-play"></i> Playlist:</span>
                                <span class="event-detail-value">${escapeHtml(props.playlist_name)}</span>
                            </div>` : ''}
                            ${props.video_type || props.role || props.custom_tags ? `
                            <div class="event-detail-row">
                                <span class="event-detail-label"><i class="bi bi-tags"></i> Tags:</span>
                                <span class="event-detail-value">
                                    <div class="event-tags">
                                        ${props.video_type ? `<span class="event-tag type">Type: ${escapeHtml(props.video_type)}</span>` : ''}
                                        ${props.role ? `<span class="event-tag role">Role: ${escapeHtml(props.role)}</span>` : ''}
                                        ${props.custom_tags ? props.custom_tags.split(',').map(tag => `<span class="event-tag custom">${escapeHtml(tag.trim())}</span>`).join('') : ''}
                                    </div>
                                </span>
                            </div>` : ''}
                            ${props.description ? `
                            <div class="event-detail-row">
                                <span class="event-detail-label"><i class="bi bi-file-text"></i> Description:</span>
                                <span class="event-detail-value" style="font-size: 13px; color: var(--buffer-text-light);">${escapeHtml(props.description)}</span>
                            </div>` : ''}
                        </div>
                    `;
                    
                    const modalBody = document.getElementById('eventModalContent').parentElement;
                    // Remove old details if any
                    const oldDetails = modalBody.querySelector('.event-video-details');
                    if (oldDetails) oldDetails.remove();
                    // Insert new details after post content
                    document.getElementById('eventModalContent').insertAdjacentHTML('afterend', detailsHtml);
                    
                    modal.show();
                },
                height: 'auto',
                dayMaxEvents: 4,
                moreLinkClick: 'popover',
                eventDisplay: 'block',
                eventTimeFormat: {
                    hour: 'numeric',
                    minute: '2-digit',
                    meridiem: 'short'
                }
            });
            
            calendar.render();
            
            // Load tips and stats
            loadSmartTips(calendarEvents);
            loadCalendarStats(calendarEvents);
        })
        .catch(error => {
            console.error('Error loading calendar:', error);
            calendarEl.innerHTML = '<div class="alert alert-danger">Error loading calendar data</div>';
        });
});

// Intelligent Tips System
function loadSmartTips(events) {
    const tipsContainer = document.getElementById('smartTips');
    const tips = [];
    
    // Analyze events to generate smart tips
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const weekFromNow = new Date(today);
    weekFromNow.setDate(weekFromNow.getDate() + 7);
    
    // Count events by platform
    const platformCounts = {};
    const upcomingEvents = events.filter(e => {
        const eventDate = new Date(e.start);
        return eventDate >= today && eventDate <= weekFromNow;
    });
    
    events.forEach(event => {
        const platform = event.extendedProps.platform.toLowerCase();
        platformCounts[platform] = (platformCounts[platform] || 0) + 1;
    });
    
    // Tip 1: Empty calendar
    if (events.length === 0) {
        tips.push({
            type: 'warning',
            icon: 'calendar-x',
            title: 'No Scheduled Posts',
            content: 'Your calendar is empty! Run Auto-Pilot or manually schedule posts to get started. Click the "+" button to schedule your first post.'
        });
    }
    
    // Tip 2: Upcoming posts
    if (upcomingEvents.length > 0) {
        tips.push({
            type: 'success',
            icon: 'calendar-check',
            title: `${upcomingEvents.length} Posts This Week`,
            content: `You have ${upcomingEvents.length} posts scheduled in the next 7 days. Great job staying consistent!`
        });
    } else if (events.length > 0) {
        tips.push({
            type: 'warning',
            icon: 'calendar-event',
            title: 'No Posts This Week',
            content: 'You have scheduled posts, but none in the next 7 days. Consider scheduling some content for this week to maintain engagement.'
        });
    }
    
    // Tip 3: Platform distribution
    const platforms = Object.keys(platformCounts);
    if (platforms.length === 1) {
        tips.push({
            type: 'info',
            icon: 'share',
            title: 'Single Platform Detected',
            content: `You're only posting to ${platforms[0]}. Consider diversifying to LinkedIn, Facebook, and Instagram for better reach.`
        });
    } else if (platforms.length === 3) {
        tips.push({
            type: 'success',
            icon: 'check-circle',
            title: 'Multi-Platform Strategy',
            content: 'Excellent! You\'re posting across multiple platforms. This maximizes your content reach and engagement.'
        });
    }
    
    // Tip 4: Optimal posting times
    const hourCounts = {};
    events.forEach(event => {
        if (event.start) {
            const hour = new Date(event.start).getHours();
            hourCounts[hour] = (hourCounts[hour] || 0) + 1;
        }
    });
    
    const mostCommonHour = Object.keys(hourCounts).reduce((a, b) => hourCounts[a] > hourCounts[b] ? a : b, null);
    if (mostCommonHour) {
        const hour12 = mostCommonHour > 12 ? `${mostCommonHour - 12} PM` : `${mostCommonHour} AM`;
        tips.push({
            type: 'info',
            icon: 'clock',
            title: 'Your Posting Pattern',
            content: `Most of your posts are scheduled around ${hour12}. Research shows 9-11 AM and 1-3 PM EST work best for professional content.`
        });
    }
    
    // Tip 5: Consistency
    if (events.length >= 10) {
        const daysWithPosts = new Set(events.map(e => e.start ? e.start.split('T')[0] : null)).size;
        if (daysWithPosts >= 5) {
            tips.push({
                type: 'success',
                icon: 'trophy',
                title: 'Consistent Schedule',
                content: `You have posts scheduled across ${daysWithPosts} different days. Consistency is key to building an engaged audience!`
            });
        }
    }
    
    // Tip 6: Video content
    const videosWithContent = events.filter(e => e.extendedProps.post_content && e.extendedProps.post_content.length > 50).length;
    if (videosWithContent < events.length * 0.5 && events.length > 0) {
        tips.push({
            type: 'warning',
            icon: 'file-text',
            title: 'Content Optimization',
            content: 'Some posts have short content. Longer, engaging posts (150+ characters) typically get better engagement on LinkedIn and Facebook.'
        });
    }
    
    // Tip 7: Best days
    const dayCounts = {};
    events.forEach(event => {
        if (event.start) {
            const day = new Date(event.start).getDay();
            const dayName = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][day];
            dayCounts[dayName] = (dayCounts[dayName] || 0) + 1;
        }
    });
    
    if (Object.keys(dayCounts).length > 0) {
        const bestDay = Object.keys(dayCounts).reduce((a, b) => dayCounts[a] > dayCounts[b] ? a : b);
        tips.push({
            type: 'info',
            icon: 'calendar-week',
            title: 'Your Best Day',
            content: `${bestDay} is your most active posting day. For professional content, Tuesday-Thursday typically perform best.`
        });
    }
    
    // Render tips
    if (tips.length === 0) {
        tips.push({
            type: 'info',
            icon: 'info-circle',
            title: 'Getting Started',
            content: 'Schedule your first post to see personalized tips and insights based on your posting patterns.'
        });
    }
    
    tipsContainer.innerHTML = tips.slice(0, 5).map(tip => `
        <div class="tip-item tip-${tip.type}">
            <div class="tip-item-header">
                <i class="bi bi-${tip.icon}"></i>
                ${tip.title}
            </div>
            <div class="tip-item-content">${tip.content}</div>
        </div>
    `).join('');
}

function loadCalendarStats(events) {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const weekStart = new Date(today);
    weekStart.setDate(weekStart.getDate() - weekStart.getDay()); // Start of week (Sunday)
    const weekEnd = new Date(weekStart);
    weekEnd.setDate(weekEnd.getDate() + 7);
    
    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
    const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    
    // Count events
    const thisWeek = events.filter(e => {
        if (!e.start) return false;
        const eventDate = new Date(e.start);
        return eventDate >= weekStart && eventDate < weekEnd;
    }).length;
    
    const thisMonth = events.filter(e => {
        if (!e.start) return false;
        const eventDate = new Date(e.start);
        return eventDate >= monthStart && eventDate <= monthEnd;
    }).length;
    
    // Most active platform
    const platformCounts = {};
    events.forEach(event => {
        const platform = event.extendedProps.platform || 'Unknown';
        platformCounts[platform] = (platformCounts[platform] || 0) + 1;
    });
    
    const mostActive = Object.keys(platformCounts).length > 0 
        ? Object.keys(platformCounts).reduce((a, b) => platformCounts[a] > platformCounts[b] ? a : b)
        : 'None';
    
    document.getElementById('statWeek').textContent = thisWeek;
    document.getElementById('statMonth').textContent = thisMonth;
    document.getElementById('statPlatform').textContent = mostActive;
}

// Utility function to escape HTML
function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Schedule new video function (to be implemented)
function scheduleNewVideo() {
    // Open modal to select video and schedule
    alert('Schedule new video feature - Coming soon!\n\nThis will allow you to:\n- Select a video\n- Choose platform\n- Set date/time\n- Create/schedule post');
}
</script>
{% endblock %}
