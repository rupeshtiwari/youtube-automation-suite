{% extends "base.html" %}

{% block title %}Configuration - YouTube Automation{% endblock %}

{% block page_title %}Settings{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-info-circle"></i> Setup Instructions
    </div>
    <div class="card-body">
        <p class="mb-0">Configure your API keys and scheduling settings below. All settings are saved automatically and
            the
            automation will run according to your schedule.</p>
    </div>
</div>

<form method="POST" action="/config">
    <!-- YouTube API Configuration -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="bi bi-youtube"></i> YouTube API Configuration
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Client Secret File</label>
                <div class="youtube-status mb-3">
                    {% if youtube_status.client_secret_exists %}
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i>
                        Client secret file is configured
                    </div>
                    {% if youtube_status.configured and youtube_status.channel_name %}
                    <div class="alert alert-info">
                        <i class="bi bi-broadcast"></i>
                        Connected to channel: <strong>{{ youtube_status.channel_name }}</strong>
                        {% if youtube_status.channel_id %}
                        <br><small>Channel ID: {{ youtube_status.channel_id }}</small>
                        {% endif %}
                    </div>
                    {% endif %}
                    {% else %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        Client secret file not found. Please upload your client_secret.json file.
                    </div>
                    {% endif %}
                    {% if youtube_status.error %}
                    <div class="alert alert-danger">
                        <i class="bi bi-x-circle"></i>
                        Error: {{ youtube_status.error }}
                    </div>
                    {% endif %}
                </div>
                <div class="file-upload-area">
                    <form id="clientSecretUploadForm" enctype="multipart/form-data">
                        <div class="input-group">
                            <input type="file" class="form-control" id="clientSecretFile" accept=".json" required>
                            <button class="btn btn-primary" type="submit" id="uploadClientSecretBtn">
                                <i class="bi bi-upload"></i> Upload
                            </button>
                        </div>
                        <small class="text-muted">
                            Upload your client_secret.json file from Google Cloud Console.
                            <a href="/docs#youtube-setup" target="_blank">Learn how to get it</a>
                        </small>
                    </form>
                    <div id="uploadStatus" class="mt-2" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- API Keys Section -->
    <div class="card">
        <div class="card-header">
            <i class="bi bi-key"></i> API Keys & Credentials
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        LinkedIn Client ID
                        <span class="help-icon" onclick="showHelp('linkedin-client-id')" title="Help">?</span>
                    </label>
                    <input type="text" class="form-control" name="linkedin_client_id"
                        value="{{ settings.api_keys.linkedin_client_id }}" placeholder="Enter LinkedIn Client ID">
                    <small class="text-muted">Get from LinkedIn Developer Portal → App → Auth tab</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        LinkedIn Client Secret
                        <span class="help-icon" onclick="showHelp('linkedin-client-secret')" title="Help">?</span>
                    </label>
                    <input type="password" class="form-control" name="linkedin_client_secret"
                        value="{{ settings.api_keys.linkedin_client_secret }}"
                        placeholder="Enter LinkedIn Client Secret">
                    <small class="text-muted">Get from LinkedIn Developer Portal → App → Auth tab</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        LinkedIn Access Token (Optional)
                        <span class="help-icon" onclick="showHelp('linkedin-access-token')" title="Help">?</span>
                    </label>
                    <input type="password" class="form-control" name="linkedin_access_token"
                        value="{{ settings.api_keys.linkedin_access_token }}"
                        placeholder="Enter LinkedIn access token (optional)">
                    <small class="text-muted">Optional: If you already have an access token, you can use it
                        directly</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        LinkedIn Person URN
                        <span class="help-icon" onclick="showHelp('linkedin-person-urn')" title="Help">?</span>
                    </label>
                    <input type="text" class="form-control" name="linkedin_person_urn"
                        value="{{ settings.api_keys.linkedin_person_urn }}" placeholder="urn:li:person:xxxxx">
                    <small class="text-muted">Format: urn:li:person:xxxxx (required for posting)</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        Facebook App ID
                        <span class="help-icon" onclick="showHelp('facebook-app-id')" title="Help">?</span>
                    </label>
                    <input type="text" class="form-control" name="facebook_app_id"
                        value="{{ settings.api_keys.facebook_app_id }}" placeholder="Enter Facebook App ID">
                    <small class="text-muted">Get from Facebook Developers → App → Settings</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        Facebook App Secret
                        <span class="help-icon" onclick="showHelp('facebook-app-secret')" title="Help">?</span>
                    </label>
                    <input type="password" class="form-control" name="facebook_app_secret"
                        value="{{ settings.api_keys.facebook_app_secret }}" placeholder="Enter Facebook App Secret">
                    <small class="text-muted">Get from Facebook Developers → App → Settings</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        Facebook Page Access Token (Optional)
                        <span class="help-icon" onclick="showHelp('facebook-page-token')" title="Help">?</span>
                    </label>
                    <input type="password" class="form-control" name="facebook_page_access_token"
                        value="{{ settings.api_keys.facebook_page_access_token }}"
                        placeholder="Enter Facebook page access token (optional)">
                    <small class="text-muted">Optional: If you already have a page access token, you can use it
                        directly</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        Facebook Page ID
                        <span class="help-icon" onclick="showHelp('facebook-page-id')" title="Help">?</span>
                    </label>
                    <input type="text" class="form-control" name="facebook_page_id"
                        value="{{ settings.api_keys.facebook_page_id }}" placeholder="Enter Facebook page ID">
                    <small class="text-muted">Required: Your Facebook Page ID (found in Page Settings)</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        Instagram Business Account ID
                        <span class="help-icon" onclick="showHelp('instagram-account-id')" title="Help">?</span>
                    </label>
                    <input type="text" class="form-control" name="instagram_business_account_id"
                        value="{{ settings.api_keys.instagram_business_account_id }}"
                        placeholder="Enter Instagram business account ID">
                    <small class="text-muted">Get from Facebook Page → Instagram → Business Account ID</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        Instagram Access Token (Optional)
                        <span class="help-icon" onclick="showHelp('instagram-access-token')" title="Help">?</span>
                    </label>
                    <input type="password" class="form-control" name="instagram_access_token"
                        value="{{ settings.api_keys.instagram_access_token }}"
                        placeholder="Enter Instagram access token (optional)">
                    <small class="text-muted">Optional: If you already have an access token, you can use it directly.
                        Otherwise, use Facebook App ID/Secret above.</small>
                </div>
                <div class="col-md-12 mb-3">
                    <label class="form-label">Ayrshare API Key (Alternative)</label>
                    <input type="password" class="form-control" name="ayrshare_api_key"
                        value="{{ settings.api_keys.ayrshare_api_key }}"
                        placeholder="Enter Ayrshare API key (optional)">
                    <small class="text-muted">Use Ayrshare for simpler unified API access. Sign up at
                        ayrshare.com</small>
                </div>
            </div>
            <div class="mt-3">
                <button type="button" class="btn btn-outline-secondary" onclick="testConnections()">
                    <i class="bi bi-check-circle"></i> Test Connections
                </button>
            </div>
        </div>
    </div>

    <!-- Scheduling Section -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="bi bi-calendar-event"></i> Scheduling Settings
        </div>
        <div class="card-body">
            <div class="mb-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" name="scheduling_enabled" id="scheduling_enabled"
                        {{ 'checked' if settings.scheduling.enabled else '' }}>
                    <label class="form-check-label" for="scheduling_enabled">
                        <strong>Enable Daily Automation</strong>
                    </label>
                </div>
                <small class="text-muted">When enabled, automation runs automatically according to schedule</small>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Videos Per Day</label>
                    <input type="number" class="form-control" name="videos_per_day"
                        value="{{ settings.scheduling.videos_per_day }}" min="1" max="10">
                    <small class="text-muted">Number of videos to process per day</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Schedule Day</label>
                    <select class="form-select" name="schedule_day">
                        <option value="monday" {{ 'selected' if settings.scheduling.schedule_day=='monday' else '' }}>
                            Monday</option>
                        <option value="tuesday" {{ 'selected' if settings.scheduling.schedule_day=='tuesday' else '' }}>
                            Tuesday</option>
                        <option value="wednesday" {{ 'selected' if settings.scheduling.schedule_day=='wednesday' else ''
                            }}>Wednesday</option>
                        <option value="thursday" {{ 'selected' if settings.scheduling.schedule_day=='thursday' else ''
                            }}>Thursday</option>
                        <option value="friday" {{ 'selected' if settings.scheduling.schedule_day=='friday' else '' }}>
                            Friday</option>
                        <option value="saturday" {{ 'selected' if settings.scheduling.schedule_day=='saturday' else ''
                            }}>Saturday</option>
                        <option value="sunday" {{ 'selected' if settings.scheduling.schedule_day=='sunday' else '' }}>
                            Sunday</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">YouTube Schedule Time (IST)</label>
                    <input type="time" class="form-control" name="youtube_schedule_time"
                        value="{{ settings.scheduling.youtube_schedule_time }}">
                    <small class="text-muted">Time to schedule YouTube videos (default: 23:00 = 11:00 PM)</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Social Media Schedule Time (IST)</label>
                    <input type="time" class="form-control" name="social_media_schedule_time"
                        value="{{ settings.scheduling.social_media_schedule_time }}">
                    <small class="text-muted">Time to post on social media (default: 19:30 = 7:30 PM)</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">YouTube Playlist ID</label>
                    <input type="text" class="form-control" name="playlist_id"
                        value="{{ settings.scheduling.playlist_id }}" placeholder="PLxxxx...">
                    <small class="text-muted">Playlist ID for video scheduling (optional)</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Export Type</label>
                    <select class="form-select" name="export_type">
                        <option value="shorts" {{ 'selected' if settings.scheduling.export_type=='shorts' else '' }}>
                            Shorts Only</option>
                        <option value="all" {{ 'selected' if settings.scheduling.export_type=='all' else '' }}>All
                            Playlists</option>
                    </select>
                </div>
                <div class="col-md-12 mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="use_database" id="use_database"
                            {{ 'checked' if settings.scheduling.get('use_database', True) else '' }}>
                        <label class="form-check-label" for="use_database">
                            <strong>Use SQLite Database (Recommended)</strong>
                        </label>
                    </div>
                    <small class="text-muted">
                        ✅ Database is faster, supports concurrent access, and is better for automation.
                        You can still export to Excel for manual review anytime.
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Social Media Posting Section -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="bi bi-share"></i> Social Media Posting
        </div>
        <div class="card-body">
            <div class="mb-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" name="auto_post_social" id="auto_post_social"
                        {{ 'checked' if settings.scheduling.auto_post_social else '' }}>
                    <label class="form-check-label" for="auto_post_social">
                        <strong>Automatically Post to Social Media</strong>
                    </label>
                </div>
                <small class="text-muted">When enabled, posts will be automatically published to selected
                    platforms</small>
            </div>

            <div class="mb-3">
                <label class="form-label">Select Platforms</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="social_platforms" value="linkedin"
                        id="platform_linkedin" {{ 'checked' if 'linkedin' in settings.scheduling.social_platforms
                        else '' }}>
                    <label class="form-check-label" for="platform_linkedin">LinkedIn</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="social_platforms" value="facebook"
                        id="platform_facebook" {{ 'checked' if 'facebook' in settings.scheduling.social_platforms
                        else '' }}>
                    <label class="form-check-label" for="platform_facebook">Facebook</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="social_platforms" value="instagram"
                        id="platform_instagram" {{ 'checked' if 'instagram' in settings.scheduling.social_platforms
                        else '' }}>
                    <label class="form-check-label" for="platform_instagram">Instagram</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Button -->
    <div class="mt-4">
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-save"></i> Save Configuration
        </button>
    </div>
</form>
{% endblock %}

{% block extra_css %}
<style>
    /* Help Icon Styles */
    .help-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--buffer-primary);
        color: white;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        margin-left: 6px;
        vertical-align: middle;
        transition: all 0.2s;
    }
    
    .help-icon:hover {
        background: var(--buffer-primary);
        opacity: 0.8;
        transform: scale(1.1);
    }
    
    .form-label {
        display: flex;
        align-items: center;
    }
    
    /* Help Modal Styles */
    .help-modal .modal-body {
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .help-content {
        line-height: 1.8;
    }
    
    .help-content ol, .help-content ul {
        padding-left: 24px;
        margin: 12px 0;
    }
    
    .help-content li {
        margin: 8px 0;
    }
    
    .help-content code {
        background: var(--buffer-bg-light);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 13px;
        color: var(--buffer-primary);
    }
    
    .help-content .alert {
        margin: 12px 0;
    }
    
    .help-link {
        color: var(--buffer-primary);
        text-decoration: none;
        font-weight: 500;
    }
    
    .help-link:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

<!-- Help Modal -->
<div class="modal fade help-modal" id="helpModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="helpModalTitle">Help</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="help-content" id="helpModalContent"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    // Help content for each field
    const helpContent = {
        'linkedin-client-id': {
            title: 'LinkedIn Client ID',
            content: `
                <h6>How to get LinkedIn Client ID:</h6>
                <ol>
                    <li>Go to <a href="https://www.linkedin.com/developers/" target="_blank" class="help-link">LinkedIn Developers</a></li>
                    <li>Sign in with your LinkedIn account</li>
                    <li>Click <strong>"Create app"</strong> or select your existing app</li>
                    <li>Go to the <strong>"Auth"</strong> tab</li>
                    <li>Under <strong>"OAuth 2.0 settings"</strong>, you'll see your <strong>"Client ID"</strong></li>
                    <li>Copy and paste it here</li>
                </ol>
                <div class="alert alert-info">
                    <strong>Tip:</strong> Your Client ID is public and can be shared. It's different from your Client Secret.
                </div>
            `
        },
        'linkedin-client-secret': {
            title: 'LinkedIn Client Secret',
            content: `
                <h6>How to get LinkedIn Client Secret:</h6>
                <ol>
                    <li>Go to <a href="https://www.linkedin.com/developers/" target="_blank" class="help-link">LinkedIn Developers</a></li>
                    <li>Select your app</li>
                    <li>Go to the <strong>"Auth"</strong> tab</li>
                    <li>Under <strong>"OAuth 2.0 settings"</strong>, find <strong>"Client Secret"</strong></li>
                    <li>Click <strong>"Show"</strong> to reveal it (you may need to verify your identity)</li>
                    <li>Copy and paste it here</li>
                </ol>
                <div class="alert alert-warning">
                    <strong>Important:</strong> Keep your Client Secret private! Never share it publicly or commit it to version control.
                </div>
            `
        },
        'linkedin-access-token': {
            title: 'LinkedIn Access Token (Optional)',
            content: `
                <h6>LinkedIn Access Token:</h6>
                <p>This field is <strong>optional</strong>. You only need it if you already have an access token.</p>
                
                <h6>If you don't have one:</h6>
                <p>Just enter your <strong>Client ID</strong> and <strong>Client Secret</strong> above. The system will generate an access token using OAuth flow when needed.</p>
                
                <h6>If you want to get one manually:</h6>
                <ol>
                    <li>Go to your LinkedIn app's <strong>"Auth"</strong> tab</li>
                    <li>Click <strong>"Generate a token"</strong></li>
                    <li>Select scopes: <code>w_member_social</code> (required for posting)</li>
                    <li>Click <strong>"Generate token"</strong></li>
                    <li>Copy the token and paste it here</li>
                </ol>
            `
        },
        'linkedin-person-urn': {
            title: 'LinkedIn Person URN',
            content: `
                <h6>How to get LinkedIn Person URN:</h6>
                
                <h6>Method 1: From LinkedIn Profile URL</h6>
                <ol>
                    <li>Go to your <a href="https://www.linkedin.com/me" target="_blank" class="help-link">LinkedIn Profile</a></li>
                    <li>Check your profile URL (e.g., <code>linkedin.com/in/yourname-123456/</code>)</li>
                    <li>The URN format is: <code>urn:li:person:xxxxx</code></li>
                </ol>
                
                <h6>Method 2: Using LinkedIn API</h6>
                <ol>
                    <li>Use your LinkedIn Access Token</li>
                    <li>Make a request: <code>GET https://api.linkedin.com/v2/me</code></li>
                    <li>The response contains an <code>id</code> field</li>
                    <li>Copy that ID (format: <code>urn:li:person:xxxxx</code>)</li>
                </ol>
                
                <h6>Method 3: From Developer Portal</h6>
                <ol>
                    <li>Go to <a href="https://www.linkedin.com/developers/" target="_blank" class="help-link">LinkedIn Developers</a></li>
                    <li>Select your app</li>
                    <li>Go to <strong>"Products"</strong> → <strong>"Marketing Developer Platform"</strong></li>
                    <li>Your Person URN may be displayed there</li>
                </ol>
                
                <div class="alert alert-info">
                    <strong>Format:</strong> Must be in the format <code>urn:li:person:xxxxx</code> (required for posting)
                </div>
            `
        },
        'facebook-app-id': {
            title: 'Facebook App ID',
            content: `
                <h6>How to get Facebook App ID:</h6>
                <ol>
                    <li>Go to <a href="https://developers.facebook.com/" target="_blank" class="help-link">Facebook Developers</a></li>
                    <li>Sign in with your Facebook account</li>
                    <li>Click <strong>"My Apps"</strong> → <strong>"Create App"</strong> (or select existing app)</li>
                    <li>Select app type: <strong>"Business"</strong> or <strong>"Other"</strong></li>
                    <li>Fill in app name and click <strong>"Create App"</strong></li>
                    <li>In your app dashboard, go to <strong>"Settings"</strong> → <strong>"Basic"</strong></li>
                    <li>Find <strong>"App ID"</strong> - copy and paste it here</li>
                </ol>
                <div class="alert alert-info">
                    <strong>Note:</strong> You'll need to add the <strong>"Pages"</strong> product to your app for posting functionality.
                </div>
            `
        },
        'facebook-app-secret': {
            title: 'Facebook App Secret',
            content: `
                <h6>How to get Facebook App Secret:</h6>
                <ol>
                    <li>Go to <a href="https://developers.facebook.com/" target="_blank" class="help-link">Facebook Developers</a></li>
                    <li>Select your app</li>
                    <li>Go to <strong>"Settings"</strong> → <strong>"Basic"</strong></li>
                    <li>Find <strong>"App Secret"</strong></li>
                    <li>Click <strong>"Show"</strong> to reveal it (you may need to enter your password)</li>
                    <li>Copy and paste it here</li>
                </ol>
                <div class="alert alert-warning">
                    <strong>Important:</strong> Keep your App Secret private! Never share it publicly or commit it to version control.
                </div>
            `
        },
        'facebook-page-token': {
            title: 'Facebook Page Access Token (Optional)',
            content: `
                <h6>Facebook Page Access Token:</h6>
                <p>This field is <strong>optional</strong>. You only need it if you already have a page access token.</p>
                
                <h6>If you don't have one:</h6>
                <p>Just enter your <strong>App ID</strong> and <strong>App Secret</strong> above. The system will generate a page access token using OAuth flow when needed.</p>
                
                <h6>If you want to get one manually:</h6>
                <ol>
                    <li>Go to <a href="https://developers.facebook.com/tools/explorer/" target="_blank" class="help-link">Graph API Explorer</a></li>
                    <li>Select your app from the dropdown</li>
                    <li>Click <strong>"Generate Access Token"</strong></li>
                    <li>Select permissions: <code>pages_show_list</code>, <code>pages_manage_posts</code></li>
                    <li>Generate the token</li>
                    <li>Call <code>GET /me/accounts</code> to get your pages</li>
                    <li>Copy the <code>access_token</code> for your target page</li>
                </ol>
            `
        },
        'facebook-page-id': {
            title: 'Facebook Page ID',
            content: `
                <h6>How to get Facebook Page ID:</h6>
                
                <h6>Method 1: From Facebook Page Settings</h6>
                <ol>
                    <li>Go to your <a href="https://www.facebook.com/pages" target="_blank" class="help-link">Facebook Page</a></li>
                    <li>Click <strong>"Settings"</strong> on the left sidebar</li>
                    <li>Click <strong>"Page Info"</strong></li>
                    <li>Scroll down to find <strong>"Page ID"</strong></li>
                    <li>Copy and paste it here</li>
                </ol>
                
                <h6>Method 2: Using Graph API Explorer</h6>
                <ol>
                    <li>Go to <a href="https://developers.facebook.com/tools/explorer/" target="_blank" class="help-link">Graph API Explorer</a></li>
                    <li>Select your app and generate a token</li>
                    <li>Call <code>GET /me/accounts</code></li>
                    <li>The response shows all your pages with their <code>id</code> fields</li>
                    <li>Copy the <code>id</code> for your target page</li>
                </ol>
                
                <h6>Method 3: From Page URL</h6>
                <ol>
                    <li>Go to your Facebook Page</li>
                    <li>Click <strong>"About"</strong> on the left sidebar</li>
                    <li>Scroll down to find <strong>"Page ID"</strong></li>
                    <li>Copy and paste it here</li>
                </ol>
            `
        },
        'instagram-account-id': {
            title: 'Instagram Business Account ID',
            content: `
                <h6>How to get Instagram Business Account ID:</h6>
                
                <h6>Prerequisites:</h6>
                <ul>
                    <li>Your Instagram account must be converted to a <strong>Business Account</strong></li>
                    <li>It must be connected to a Facebook Page</li>
                </ul>
                
                <h6>Method 1: Using Graph API Explorer</h6>
                <ol>
                    <li>Go to <a href="https://developers.facebook.com/tools/explorer/" target="_blank" class="help-link">Graph API Explorer</a></li>
                    <li>Select your Facebook app</li>
                    <li>Use your Facebook Page Access Token</li>
                    <li>Call: <code>GET /{page-id}?fields=instagram_business_account</code></li>
                    <li>Replace <code>{page-id}</code> with your Facebook Page ID</li>
                    <li>The response contains <code>instagram_business_account.id</code></li>
                    <li>Copy that ID and paste it here</li>
                </ol>
                
                <h6>Method 2: From Facebook Page Settings</h6>
                <ol>
                    <li>Go to your Facebook Page</li>
                    <li>Click <strong>"Settings"</strong> → <strong>"Instagram"</strong></li>
                    <li>Your Instagram Business Account ID may be displayed there</li>
                </ol>
                
                <div class="alert alert-warning">
                    <strong>Note:</strong> Instagram requires a Business Account. Convert your personal account to Business in Instagram app → Settings → Account → Switch to Professional Account → Business.
                </div>
            `
        },
        'instagram-access-token': {
            title: 'Instagram Access Token (Optional)',
            content: `
                <h6>Instagram Access Token:</h6>
                <p>This field is <strong>optional</strong>. Instagram uses the same access token as your Facebook Page.</p>
                
                <h6>If you don't have one:</h6>
                <p>Just enter your <strong>Facebook App ID</strong> and <strong>Facebook App Secret</strong> above. The Instagram access token is the same as your Facebook Page Access Token.</p>
                
                <h6>If you want to get one manually:</h6>
                <ol>
                    <li>Follow the steps to get a Facebook Page Access Token</li>
                    <li>Your Instagram Access Token is the same as your Facebook Page Access Token</li>
                    <li>Make sure your Instagram Business Account is connected to the Facebook Page</li>
                </ol>
                
                <div class="alert alert-info">
                    <strong>Important:</strong> Instagram API uses the Facebook Graph API, so they share the same access token.
                </div>
            `
        }
    };

    function showHelp(fieldId) {
        const help = helpContent[fieldId];
        if (!help) {
            alert('Help content not available for this field.');
            return;
        }
        
        document.getElementById('helpModalTitle').textContent = help.title;
        document.getElementById('helpModalContent').innerHTML = help.content;
        
        const modal = new bootstrap.Modal(document.getElementById('helpModal'));
        modal.show();
    }

    // Handle client secret file upload
    document.getElementById('clientSecretUploadForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const fileInput = document.getElementById('clientSecretFile');
        const uploadBtn = document.getElementById('uploadClientSecretBtn');
        const statusDiv = document.getElementById('uploadStatus');

        if (!fileInput.files.length) {
            statusDiv.innerHTML = '<div class="alert alert-danger">Please select a file</div>';
            statusDiv.style.display = 'block';
            return;
        }

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Uploading...';
        statusDiv.style.display = 'none';

        fetch('/api/config/upload-client-secret', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    statusDiv.innerHTML = '<div class="alert alert-success"><i class="bi bi-check-circle"></i> ' + data.message + '</div>';
                    statusDiv.style.display = 'block';
                    fileInput.value = '';

                    // Refresh page after 2 seconds to show updated status
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    statusDiv.innerHTML = '<div class="alert alert-danger"><i class="bi bi-x-circle"></i> Error: ' + (data.error || 'Upload failed') + '</div>';
                    statusDiv.style.display = 'block';
                }
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="bi bi-upload"></i> Upload';
            })
            .catch(error => {
                statusDiv.innerHTML = '<div class="alert alert-danger"><i class="bi bi-x-circle"></i> Error: ' + error.message + '</div>';
                statusDiv.style.display = 'block';
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="bi bi-upload"></i> Upload';
            });
    });

    function testConnections() {
        const platforms = ['linkedin', 'facebook', 'instagram', 'ayrshare'];
        const results = [];

        platforms.forEach(platform => {
            fetch('/api/test-connection', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ platform: platform })
            })
                .then(response => response.json())
                .then(data => {
                    results.push({ platform: platform, ...data });
                    if (results.length === platforms.length) {
                        showTestResults(results);
                    }
                })
                .catch(error => {
                    results.push({ platform: platform, success: false, message: 'Error: ' + error });
                    if (results.length === platforms.length) {
                        showTestResults(results);
                    }
                });
        });
    }

    function showTestResults(results) {
        let message = 'Connection Test Results:\n\n';
        results.forEach(result => {
            const icon = result.success ? '✅' : '❌';
            message += `${icon} ${result.platform.toUpperCase()}: ${result.message}\n`;
        });
        alert(message);
    }
</script>
{% endblock %}