<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}YouTube Automation{% endblock %}</title>
        <!-- Favicon - Multiple formats for maximum compatibility with cache busting -->
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}?v=2">
        <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon.png') }}?v=2">
        <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}?v=2">
        <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='favicon.png') }}?v=2">
        <link rel="shortcut icon" href="{{ url_for('favicon') }}">
        <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/theme-enhancements.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-theme.css') }}">
        <meta name="theme-color" content="#7c3aed">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <meta name="apple-mobile-web-app-title" content="YT Auto">
        <meta name="mobile-web-app-capable" content="yes">
        <style>
            :root {
                /* Modern Professional Color Scheme - Light Mode */
                --primary: #2563eb;
                --primary-hover: #1d4ed8;
                --primary-light: #3b82f6;
                --secondary: #64748b;
                --success: #10b981;
                --warning: #f59e0b;
                --danger: #ef4444;
                --info: #06b6d4;
                
                --text-primary: #0f172a;
                --text-secondary: #475569;
                --text-muted: #94a3b8;
                --text-light: #cbd5e1;
                
                --bg-primary: #ffffff;
                --bg-secondary: #f8fafc;
                --bg-tertiary: #f1f5f9;
                --bg-hover: #e2e8f0;
                
                --border: #e2e8f0;
                --border-light: #f1f5f9;
                --border-dark: #cbd5e1;
                
                --card-bg: #ffffff;
                --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
                --card-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                
                /* Platform colors */
                --linkedin: #0077b5;
                --facebook: #1877f2;
                --instagram: #e4405f;
                --youtube: #ff0000;
                
                /* Gradient */
                --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
                --gradient-blue: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            }

            [data-theme="dark"] {
                /* Modern Professional Color Scheme - Dark Mode */
                --primary: #3b82f6;
                --primary-hover: #2563eb;
                --primary-light: #60a5fa;
                --secondary: #94a3b8;
                --success: #10b981;
                --warning: #f59e0b;
                --danger: #ef4444;
                --info: #06b6d4;
                
                --text-primary: #f1f5f9;
                --text-secondary: #cbd5e1;
                --text-muted: #94a3b8;
                --text-light: #64748b;
                
                --bg-primary: #0f172a;
                --bg-secondary: #1e293b;
                --bg-tertiary: #334155;
                --bg-hover: #475569;
                
                --border: #334155;
                --border-light: #1e293b;
                --border-dark: #475569;
                
                --card-bg: #1e293b;
                --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
                --card-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: var(--bg-secondary);
                color: var(--text-primary);
                font-size: 14px;
                line-height: 1.6;
                transition: background-color 0.3s ease, color 0.3s ease;
            }

            /* Sidebar Navigation - Buffer Style */
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                width: 240px;
                height: 100vh;
                background: var(--bg-primary);
                border-right: 1px solid var(--border);
                padding: 24px 0;
                overflow-y: auto;
                z-index: 1000;
                transition: background-color 0.3s ease, border-color 0.3s ease;
                box-shadow: 2px 0 8px rgba(0, 0, 0, 0.04);
            }

            .sidebar-brand {
                padding: 0 24px 32px;
                border-bottom: 1px solid var(--border);
                margin-bottom: 24px;
                transition: border-color 0.3s ease;
            }

            .sidebar-brand h1 {
                font-size: 20px;
                font-weight: 700;
                color: var(--primary);
                margin: 0;
            }

            .sidebar-nav {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .sidebar-nav li {
                margin: 0;
            }

            .sidebar-nav a {
                display: flex;
                align-items: center;
                padding: 12px 24px;
                color: var(--text-secondary);
                text-decoration: none;
                font-weight: 500;
                transition: all 0.2s;
                border-left: 3px solid transparent;
            }

            .sidebar-nav a:hover {
                background: var(--bg-hover);
                color: var(--primary);
            }

            .sidebar-nav a.active {
                background: var(--bg-hover);
                color: var(--primary);
                border-left-color: var(--primary);
                font-weight: 600;
            }

            .sidebar-nav a i {
                width: 20px;
                margin-right: 12px;
                font-size: 18px;
            }

            .nav-divider {
                height: 1px;
                background: var(--border);
                margin: 8px 24px;
                list-style: none;
            }

            /* Main Content Area */
            .main-content {
                margin-left: 240px;
                min-height: 100vh;
                background: var(--bg-secondary);
            }

            /* Top Bar */
            .top-bar {
                background: var(--bg-primary);
                border-bottom: 1px solid var(--border);
                padding: 16px 32px;
                position: sticky;
                top: 0;
                z-index: 100;
                transition: background-color 0.3s ease, border-color 0.3s ease;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            }

            .top-bar h2 {
                font-size: 24px;
                font-weight: 600;
                color: var(--text-primary);
                margin: 0;
            }

            /* Content Container */
            .content-container {
                padding: 32px;
                max-width: 1400px;
            }

            /* Cards - Modern Style */
            .card {
                background: var(--card-bg);
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 24px;
                margin-bottom: 24px;
                box-shadow: var(--card-shadow);
                transition: all 0.3s ease;
            }

            .card:hover {
                box-shadow: var(--card-shadow-hover);
                transform: translateY(-2px);
            }

            .card-header {
                background: transparent;
                border-bottom: 1px solid var(--border);
                padding: 0 0 16px;
                margin-bottom: 16px;
                font-weight: 600;
                font-size: 16px;
                color: var(--text-primary);
                transition: color 0.3s ease, border-color 0.3s ease;
            }

            /* Buttons - Modern Enhanced Style */
            .btn {
                border-radius: 8px;
                padding: 10px 24px;
                font-weight: 600;
                font-size: 14px;
                border: none;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                will-change: transform, box-shadow;
                position: relative;
                overflow: hidden;
            }

            .btn-primary {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }

            .btn-primary:hover {
                background: var(--primary-hover);
                border-color: var(--primary-hover);
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
            }
            
            .btn-primary:active {
                transform: translateY(0);
            }

            .btn-success {
                background: var(--success);
                color: white;
                border-color: var(--success);
            }

            .btn-success:hover {
                background: #059669;
                border-color: #059669;
                color: white;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            }

            .btn-outline-secondary {
                background: var(--bg-primary);
                color: var(--text-secondary);
                border-color: var(--border);
            }

            .btn-outline-secondary:hover {
                background: var(--bg-hover);
                border-color: var(--border-dark);
                color: var(--text-primary);
            }

            /* Form Elements */
            .form-control,
            .form-select {
                border: 1px solid var(--border);
                border-radius: 8px;
                padding: 10px 14px;
                font-size: 14px;
                background: var(--bg-primary);
                color: var(--text-primary);
                transition: all 0.2s ease;
            }

            .form-control:focus,
            .form-select:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
                background: var(--bg-primary);
                color: var(--text-primary);
                outline: none;
            }

            .form-label {
                font-weight: 500;
                color: var(--text-primary);
                margin-bottom: 8px;
                margin-bottom: 8px;
                font-size: 14px;
            }

            /* Badges */
            .badge {
                padding: 4px 10px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 500;
            }

            /* Status Badges */
            .status-badge {
                padding: 6px 12px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 500;
                display: inline-flex;
                align-items: center;
                gap: 6px;
            }

            .status-active {
                background: #d4edda;
                color: #155724;
            }

            .status-inactive {
                background: #f8d7da;
                color: #721c24;
            }

            /* Remove old navbar styles */
            .navbar {
                display: none;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .sidebar {
                    transform: translateX(-100%);
                    transition: transform 0.3s;
                }

                .main-content {
                    margin-left: 0;
                }
            }

            /* Utility Classes */
            .text-muted {
                color: var(--buffer-text-light) !important;
            }

            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                font-weight: 600;
                color: var(--buffer-text);
                transition: color 0.3s ease;
            }

            /* Theme Switcher */
            .theme-switcher {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 12px;
                border-radius: 6px;
                background: var(--buffer-hover);
                border: 1px solid var(--buffer-border);
                cursor: pointer;
                transition: all 0.2s;
                font-size: 13px;
                color: var(--buffer-text);
                margin: 16px 24px 0;
            }

            .theme-switcher:hover {
                background: var(--buffer-border);
            }

            .theme-switcher i {
                font-size: 16px;
            }

            .theme-menu {
                position: absolute;
                bottom: 60px;
                left: 24px;
                right: 24px;
                background: var(--buffer-card-bg);
                border: 1px solid var(--buffer-border);
                border-radius: 8px;
                padding: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                display: none;
                z-index: 1001;
                transition: background-color 0.3s ease, border-color 0.3s ease;
            }

            .theme-menu.active {
                display: block;
            }

            .theme-option {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 10px 12px;
                border-radius: 6px;
                cursor: pointer;
                transition: background 0.2s;
                color: var(--buffer-text);
            }

            .theme-option:hover {
                background: var(--buffer-hover);
            }

            .theme-option.active {
                background: var(--buffer-hover);
                font-weight: 600;
            }

            .theme-option i {
                width: 20px;
                text-align: center;
            }

            /* Toast Notifications */
            .toast-container {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                display: flex;
                flex-direction: column;
                gap: 12px;
                max-width: 400px;
            }

            .toast {
                background: var(--card-bg);
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 16px 20px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
                display: flex;
                align-items: flex-start;
                gap: 12px;
                animation: slideInRight 0.3s ease-out;
                min-width: 300px;
                transition: all 0.3s ease;
            }

            .toast.hiding {
                animation: slideOutRight 0.3s ease-out forwards;
            }

            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }

            .toast-icon {
                font-size: 24px;
                flex-shrink: 0;
            }

            .toast-content {
                flex: 1;
            }

            .toast-title {
                font-weight: 600;
                font-size: 14px;
                margin-bottom: 4px;
                color: var(--text-primary);
            }

            .toast-message {
                font-size: 13px;
                color: var(--text-secondary);
                line-height: 1.5;
            }

            .toast-close {
                background: none;
                border: none;
                color: var(--text-muted);
                cursor: pointer;
                font-size: 18px;
                padding: 0;
                width: 24px;
                height: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 4px;
                transition: all 0.2s;
                flex-shrink: 0;
            }

            .toast-close:hover {
                background: var(--bg-hover);
                color: var(--text-primary);
            }

            .toast-success {
                border-left: 4px solid var(--success);
            }

            .toast-success .toast-icon {
                color: var(--success);
            }

            .toast-error {
                border-left: 4px solid var(--danger);
            }

            .toast-error .toast-icon {
                color: var(--danger);
            }

            .toast-warning {
                border-left: 4px solid var(--warning);
            }

            .toast-warning .toast-icon {
                color: var(--warning);
            }

            .toast-info {
                border-left: 4px solid var(--info);
            }

            .toast-info .toast-icon {
                color: var(--info);
            }

            /* Loading States */
            .btn-loading {
                position: relative;
                color: transparent !important;
                pointer-events: none;
            }

            .btn-loading::after {
                content: "";
                position: absolute;
                width: 16px;
                height: 16px;
                top: 50%;
                left: 50%;
                margin-left: -8px;
                margin-top: -8px;
                border: 2px solid currentColor;
                border-radius: 50%;
                border-top-color: transparent;
                animation: spin 0.6s linear infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .spinner-border-sm {
                width: 1rem;
                height: 1rem;
                border-width: 0.15em;
            }

            /* Smooth Transitions */
            .card, .btn, .form-control, .form-select {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            /* Form Validation */
            .form-control.is-invalid,
            .form-select.is-invalid {
                border-color: var(--danger);
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
            }

            .form-control.is-valid,
            .form-select.is-valid {
                border-color: var(--success);
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            }

            .invalid-feedback {
                display: block;
                color: var(--danger);
                font-size: 12px;
                margin-top: 4px;
            }

            .valid-feedback {
                display: block;
                color: var(--success);
                font-size: 12px;
                margin-top: 4px;
            }

            /* Fade In Animation */
            .fade-in {
                animation: fadeIn 0.3s ease-in;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Pulse Animation for Loading */
            .pulse {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }

            @keyframes pulse {
                0%, 100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }
        </style>
        {% block extra_css %}{% endblock %}
    </head>

    <body>
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-brand">
                <h1><i class="bi bi-youtube" style="color: #ff0000;"></i> YouTube Automation</h1>
            </div>
            <ul class="sidebar-nav">
                <li>
                    <a href="/" id="nav-dashboard">
                        <i class="bi bi-inbox"></i>
                        Queue
                    </a>
                </li>
                <li>
                    <a href="/calendar" id="nav-calendar">
                        <i class="bi bi-calendar3"></i>
                        Calendar
                    </a>
                </li>
                <li>
                    <a href="/shorts" id="nav-shorts">
                        <i class="bi bi-camera-reels"></i>
                        Shorts
                    </a>
                </li>
                <!-- Playlists hidden - focusing on Shorts only -->
                <li>
                    <a href="/sessions" id="nav-sessions">
                        <i class="bi bi-file-text"></i>
                        Sessions
                    </a>
                </li>
                <li>
                    <a href="/content-preview" id="nav-content-preview">
                        <i class="bi bi-eye"></i>
                        Preview & Schedule
                    </a>
                </li>
                <li class="nav-divider"></li>
                <li>
                    <a href="/insights" id="nav-insights">
                        <i class="bi bi-graph-up-arrow"></i>
                        Analytics
                    </a>
                </li>
                <li>
                    <a href="/activity" id="nav-activity">
                        <i class="bi bi-activity"></i>
                        Activity
                    </a>
                </li>
                <li class="nav-divider"></li>
                <li>
                    <a href="/config" id="nav-config">
                        <i class="bi bi-gear"></i>
                        Settings
                    </a>
                </li>
            </ul>

            <!-- Theme Switcher -->
            <div class="theme-switcher" onclick="toggleThemeMenu()">
                <i class="bi bi-circle-half" id="theme-icon"></i>
                <span id="theme-text">System</span>
            </div>

            <div class="theme-menu" id="theme-menu">
                <div class="theme-option" onclick="setTheme('light')">
                    <i class="bi bi-sun"></i>
                    <span>Light</span>
                    <i class="bi bi-check ms-auto" id="check-light" style="display: none;"></i>
                </div>
                <div class="theme-option" onclick="setTheme('dark')">
                    <i class="bi bi-moon"></i>
                    <span>Dark</span>
                    <i class="bi bi-check ms-auto" id="check-dark" style="display: none;"></i>
                </div>
                <div class="theme-option active" onclick="setTheme('system')">
                    <i class="bi bi-circle-half"></i>
                    <span>System</span>
                    <i class="bi bi-check ms-auto" id="check-system"></i>
                </div>
            </div>
        </nav>

            <!-- Main Content -->
            <div class="main-content">
                <div class="top-bar">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <button class="mobile-menu-toggle" onclick="toggleSidebar()" aria-label="Toggle menu">
                            <i class="bi bi-list"></i>
                        </button>
                        <h2>{% block page_title %}Dashboard{% endblock %}</h2>
                    </div>
                </div>
                <div class="content-container">
                    <!-- Config Validation Warnings -->
                    {% if g.config_warnings %}
                    <div class="config-warnings-container mb-4">
                        {% for warning in g.config_warnings %}
                        <div class="alert alert-{{ 'danger' if warning.severity == 'error' else 'warning' }} alert-dismissible fade show config-warning" role="alert">
                            <div class="d-flex align-items-start">
                                <div class="flex-shrink-0 me-3">
                                    <i class="bi bi-{{ 'exclamation-triangle-fill' if warning.severity == 'error' else 'exclamation-circle-fill' }}" style="font-size: 24px;"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="alert-heading mb-2">
                                        {{ warning.platform }} Configuration {{ 'Error' if warning.severity == 'error' else 'Warning' }}
                                    </h5>
                                    <p class="mb-2">{{ warning.message }}</p>
                                    <p class="mb-2"><strong>Missing fields:</strong> {{ warning.fields|join(', ') }}</p>
                                    <a href="{{ warning.link }}" class="btn btn-sm btn-{{ 'danger' if warning.severity == 'error' else 'warning' }}">
                                        <i class="bi bi-gear"></i> Fix Configuration
                                    </a>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% block content %}{% endblock %}
                </div>
            </div>

        <!-- Toast Notification Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Quick Compose Modal - Available on all pages -->
        <div class="modal fade" id="quickComposeModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="bi bi-pencil-square"></i> Create New Post</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Select Platforms</label>
                            <div class="platform-selector">
                                <label class="platform-checkbox">
                                    <input type="checkbox" value="linkedin" checked>
                                    <i class="bi bi-linkedin"></i> LinkedIn
                                </label>
                                <label class="platform-checkbox">
                                    <input type="checkbox" value="facebook" checked>
                                    <i class="bi bi-facebook"></i> Facebook
                                </label>
                                <label class="platform-checkbox">
                                    <input type="checkbox" value="instagram" checked>
                                    <i class="bi bi-instagram"></i> Instagram
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Post Content</label>
                            <textarea class="form-control" id="compose-content" rows="6" placeholder="What would you like to share?"></textarea>
                            <small class="text-muted">Tip: Use YouTube video title/description as source</small>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Schedule Date</label>
                                <input type="date" class="form-control" id="compose-date">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Schedule Time</label>
                                <input type="time" class="form-control" id="compose-time">
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">YouTube Video (Optional)</label>
                            <input type="text" class="form-control" id="compose-video-url" placeholder="YouTube URL or Video ID">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="saveQuickPost()">
                            <i class="bi bi-calendar-plus"></i> Schedule Post
                        </button>
                        <button type="button" class="btn btn-success" onclick="publishNow()">
                            <i class="bi bi-send"></i> Publish Now
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Alpine.js for better interactivity -->
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <script>
            // Mobile Sidebar Toggle
            function toggleSidebar() {
                const sidebar = document.querySelector('.sidebar');
                sidebar.classList.toggle('open');
            }

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                const sidebar = document.querySelector('.sidebar');
                const toggle = document.querySelector('.mobile-menu-toggle');
                if (window.innerWidth <= 768 && sidebar && toggle) {
                    if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
                        sidebar.classList.remove('open');
                    }
                }
            });

            // Service Worker Registration for PWA
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/static/js/service-worker.js')
                        .then(function(registration) {
                            console.log('ServiceWorker registration successful:', registration.scope);
                        })
                        .catch(function(error) {
                            console.log('ServiceWorker registration failed:', error);
                        });
                });
            }

            // PWA Install Prompt
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallPrompt();
            });

            function showInstallPrompt() {
                const prompt = document.createElement('div');
                prompt.className = 'pwa-install-prompt';
                prompt.innerHTML = `
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <i class="bi bi-download" style="font-size: 24px; color: var(--primary);"></i>
                        <div style="flex: 1;">
                            <h6 style="margin: 0 0 0.5rem 0; font-weight: 600;">Install App</h6>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--text-secondary);">
                                Install this app for a better experience
                            </p>
                        </div>
                        <button onclick="installPWA()" class="btn btn-sm btn-primary" style="margin-left: 0.5rem;">
                            Install
                        </button>
                        <button onclick="this.parentElement.remove()" class="btn btn-sm" style="background: transparent; border: none; padding: 0.25rem;">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                `;
                document.body.appendChild(prompt);
            }

            async function installPWA() {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to install prompt: ${outcome}`);
                deferredPrompt = null;
                document.querySelector('.pwa-install-prompt')?.remove();
            }
        </script>
        <script>
            // Theme Management
            function getSystemTheme() {
                return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }

            function applyTheme(theme) {
                const html = document.documentElement;

                if (theme === 'system') {
                    const systemTheme = getSystemTheme();
                    html.setAttribute('data-theme', systemTheme);
                    html.classList.remove('theme-light', 'theme-dark');
                    html.classList.add('theme-' + systemTheme);
                } else {
                    html.setAttribute('data-theme', theme);
                    html.classList.remove('theme-light', 'theme-dark');
                    html.classList.add('theme-' + theme);
                }
            }

            function setTheme(theme) {
                localStorage.setItem('theme', theme);
                applyTheme(theme);
                updateThemeUI(theme);
                document.getElementById('theme-menu').classList.remove('active');
            }

            function updateThemeUI(theme) {
                // Update checkmarks
                document.getElementById('check-light').style.display = theme === 'light' ? 'inline' : 'none';
                document.getElementById('check-dark').style.display = theme === 'dark' ? 'inline' : 'none';
                document.getElementById('check-system').style.display = theme === 'system' ? 'inline' : 'none';

                // Update active class
                document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
                const activeOption = theme === 'light' ? document.querySelectorAll('.theme-option')[0] :
                    theme === 'dark' ? document.querySelectorAll('.theme-option')[1] :
                        document.querySelectorAll('.theme-option')[2];
                if (activeOption) activeOption.classList.add('active');

                // Update icon and text
                const icon = document.getElementById('theme-icon');
                const text = document.getElementById('theme-text');
                if (theme === 'light') {
                    icon.className = 'bi bi-sun';
                    text.textContent = 'Light';
                } else if (theme === 'dark') {
                    icon.className = 'bi bi-moon';
                    text.textContent = 'Dark';
                } else {
                    icon.className = 'bi bi-circle-half';
                    text.textContent = 'System';
                }
            }

            function toggleThemeMenu() {
                const menu = document.getElementById('theme-menu');
                menu.classList.toggle('active');
            }

            // Set active nav item based on current path
            document.addEventListener('DOMContentLoaded', function () {
                const path = window.location.pathname;
                const navMap = {
                    '/': 'nav-dashboard',
                    '/calendar': 'nav-calendar',
                    '/shorts': 'nav-shorts',
                    '/sessions': 'nav-sessions',
                    '/content-preview': 'nav-content-preview',
                    '/insights': 'nav-insights',
                    '/activity': 'nav-activity',
                    '/config': 'nav-config',
                    '/docs': 'nav-docs'
                };

                // Remove active from all
                document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));

                // Add active to current
                const activeId = navMap[path] || navMap['/'];
                const activeEl = document.getElementById(activeId);
                if (activeEl) {
                    activeEl.classList.add('active');
                }

                // Load saved theme preference
                const savedTheme = localStorage.getItem('theme') || 'system';
                applyTheme(savedTheme);
                updateThemeUI(savedTheme);

                // Listen for system theme changes
                if (window.matchMedia) {
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                        const currentTheme = localStorage.getItem('theme') || 'system';
                        if (currentTheme === 'system') {
                            applyTheme('system');
                        }
                    });
                }
            });

            // Close theme menu when clicking outside
            document.addEventListener('click', function (event) {
                const themeSwitcher = document.querySelector('.theme-switcher');
                const themeMenu = document.getElementById('theme-menu');
                if (themeSwitcher && themeMenu && !themeSwitcher.contains(event.target) && !themeMenu.contains(event.target)) {
                    themeMenu.classList.remove('active');
                }
            });

            // Toast Notification System
            window.Toast = {
                show: function(message, type = 'info', duration = 5000) {
                    const container = document.getElementById('toastContainer');
                    if (!container) return;

                    const toast = document.createElement('div');
                    toast.className = `toast toast-${type}`;

                    const icons = {
                        success: 'bi-check-circle-fill',
                        error: 'bi-x-circle-fill',
                        warning: 'bi-exclamation-triangle-fill',
                        info: 'bi-info-circle-fill'
                    };

                    const titles = {
                        success: 'Success',
                        error: 'Error',
                        warning: 'Warning',
                        info: 'Info'
                    };

                    toast.innerHTML = `
                        <i class="bi ${icons[type]} toast-icon"></i>
                        <div class="toast-content">
                            <div class="toast-title">${titles[type]}</div>
                            <div class="toast-message">${message}</div>
                        </div>
                        <button class="toast-close" onclick="this.parentElement.remove()">
                            <i class="bi bi-x"></i>
                        </button>
                    `;

                    container.appendChild(toast);

                    // Auto remove after duration
                    if (duration > 0) {
                        setTimeout(() => {
                            toast.classList.add('hiding');
                            setTimeout(() => toast.remove(), 300);
                        }, duration);
                    }

                    return toast;
                },
                success: function(message, duration) {
                    return this.show(message, 'success', duration);
                },
                error: function(message, duration) {
                    return this.show(message, 'error', duration);
                },
                warning: function(message, duration) {
                    return this.show(message, 'warning', duration);
                },
                info: function(message, duration) {
                    return this.show(message, 'info', duration);
                }
            };

            // Button Loading State Helper
            window.setButtonLoading = function(button, loading = true) {
                if (typeof button === 'string') {
                    button = document.querySelector(button);
                }
                if (!button) return;

                if (loading) {
                    button.disabled = true;
                    button.classList.add('btn-loading');
                    button.dataset.originalText = button.innerHTML;
                    button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Loading...';
                } else {
                    button.disabled = false;
                    button.classList.remove('btn-loading');
                    if (button.dataset.originalText) {
                        button.innerHTML = button.dataset.originalText;
                        delete button.dataset.originalText;
                    }
                }
            };

            // Quick Compose Modal - Global function
            window.openQuickCompose = function() {
                try {
                    const modalElement = document.getElementById('quickComposeModal');
                    if (!modalElement) {
                        console.error('Modal element not found');
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Modal not found. Please refresh the page.');
                        } else {
                            alert('Modal not found. Please refresh the page.');
                        }
                        return;
                    }
                    
                    // Check if Bootstrap is loaded
                    if (typeof bootstrap === 'undefined') {
                        console.error('Bootstrap is not loaded');
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Bootstrap is not loaded. Please refresh the page.');
                        } else {
                            alert('Bootstrap is not loaded. Please refresh the page.');
                        }
                        return;
                    }
                    
                    const modal = new bootstrap.Modal(modalElement);
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    
                    const dateInput = document.getElementById('compose-date');
                    const timeInput = document.getElementById('compose-time');
                    
                    if (dateInput) {
                        dateInput.value = tomorrow.toISOString().split('T')[0];
                    }
                    if (timeInput) {
                        timeInput.value = '19:30';
                    }
                    
                    // Clear previous content
                    const contentInput = document.getElementById('compose-content');
                    if (contentInput) {
                        contentInput.value = '';
                    }
                    const videoUrlInput = document.getElementById('compose-video-url');
                    if (videoUrlInput) {
                        videoUrlInput.value = '';
                    }
                    
                    // Reset platform checkboxes
                    Array.from(document.querySelectorAll('.platform-checkbox input')).forEach(cb => cb.checked = true);
                    
                    modal.show();
                } catch (error) {
                    console.error('Error opening quick compose modal:', error);
                    if (typeof Toast !== 'undefined') {
                        Toast.error('Error opening compose modal: ' + error.message);
                    } else {
                        alert('Error opening compose modal: ' + error.message);
                    }
                }
            };

            // Save Quick Post - Global function (if not already defined)
            if (typeof window.saveQuickPost === 'undefined') {
                window.saveQuickPost = function() {
                    const platforms = Array.from(document.querySelectorAll('.platform-checkbox input:checked')).map(cb => cb.value);
                    const content = document.getElementById('compose-content').value;
                    const date = document.getElementById('compose-date').value;
                    const time = document.getElementById('compose-time').value;
                    const videoUrl = document.getElementById('compose-video-url').value;
                    
                    if (!content.trim()) {
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Please enter post content');
                        } else {
                            alert('Please enter post content');
                        }
                        return;
                    }
                    
                    if (!date || !time) {
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Please select date and time');
                        } else {
                            alert('Please select date and time');
                        }
                        return;
                    }
                    
                    if (platforms.length === 0) {
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Please select at least one platform');
                        } else {
                            alert('Please select at least one platform');
                        }
                        return;
                    }
                    
                    const scheduleDateTime = `${date} ${time}`;
                    
                    // Call API to schedule posts
                    fetch('/api/queue/schedule', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            platforms: platforms,
                            content: content,
                            schedule_datetime: scheduleDateTime,
                            video_url: videoUrl
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            if (typeof Toast !== 'undefined') {
                                Toast.success('Post scheduled successfully!');
                            } else {
                                alert('Post scheduled successfully!');
                            }
                            bootstrap.Modal.getInstance(document.getElementById('quickComposeModal')).hide();
                            // Reload page or refresh queue
                            if (window.location.pathname === '/') {
                                window.location.reload();
                            }
                        } else {
                            if (typeof Toast !== 'undefined') {
                                Toast.error(data.error || 'Failed to schedule post');
                            } else {
                                alert(data.error || 'Failed to schedule post');
                            }
                        }
                    })
                    .catch(error => {
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Error: ' + error.message);
                        } else {
                            alert('Error: ' + error.message);
                        }
                    });
                };
            }

            // Publish Now - Global function (if not already defined)
            if (typeof window.publishNow === 'undefined') {
                window.publishNow = function() {
                    const platforms = Array.from(document.querySelectorAll('.platform-checkbox input:checked')).map(cb => cb.value);
                    const content = document.getElementById('compose-content').value;
                    const videoUrl = document.getElementById('compose-video-url').value;
                    
                    if (!content.trim()) {
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Please enter post content');
                        } else {
                            alert('Please enter post content');
                        }
                        return;
                    }
                    
                    if (platforms.length === 0) {
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Please select at least one platform');
                        } else {
                            alert('Please select at least one platform');
                        }
                        return;
                    }
                    
                    if (!confirm(`Publish this post immediately to ${platforms.join(', ')}?`)) {
                        return;
                    }
                    
                    // Call API to publish immediately
                    fetch('/api/queue/publish-now', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            platforms: platforms,
                            content: content,
                            video_url: videoUrl
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            if (typeof Toast !== 'undefined') {
                                Toast.success('Post published successfully!');
                            } else {
                                alert('Post published successfully!');
                            }
                            bootstrap.Modal.getInstance(document.getElementById('quickComposeModal')).hide();
                            // Reload page or refresh queue
                            if (window.location.pathname === '/') {
                                window.location.reload();
                            }
                        } else {
                            if (typeof Toast !== 'undefined') {
                                Toast.error(data.error || 'Failed to publish post');
                            } else {
                                alert(data.error || 'Failed to publish post');
                            }
                        }
                    })
                    .catch(error => {
                        if (typeof Toast !== 'undefined') {
                            Toast.error('Error: ' + error.message);
                        } else {
                            alert('Error: ' + error.message);
                        }
                    });
                };
            }

            // Enhanced Fetch Helper with Loading States
            window.fetchWithLoading = async function(url, options = {}, button = null) {
                if (button) {
                    setButtonLoading(button, true);
                }

                try {
                    const response = await fetch(url, {
                        ...options,
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        }
                    });

                    const data = await response.json();

                    if (button) {
                        setButtonLoading(button, false);
                    }

                    return { response, data };
                } catch (error) {
                    if (button) {
                        setButtonLoading(button, false);
                    }
                    throw error;
                }
            };

            // Form Validation Helper
            window.validateForm = function(form) {
                let isValid = true;
                const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');

                inputs.forEach(input => {
                    if (!input.value.trim()) {
                        input.classList.add('is-invalid');
                        input.classList.remove('is-valid');
                        isValid = false;
                    } else {
                        input.classList.remove('is-invalid');
                        input.classList.add('is-valid');
                    }
                });

                return isValid;
            };

            // Add fade-in animation to content on load
            document.addEventListener('DOMContentLoaded', function() {
                const content = document.querySelector('.content-container');
                if (content) {
                    content.classList.add('fade-in');
                }
            });
        </script>
        {% block extra_js %}{% endblock %}
    </body>

</html>